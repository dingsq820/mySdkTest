(()=>{"use strict";var e={2786:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractService=void 0;class i{constructor(){this.name="IService",this.defaultState={},this._state=this.defaultState}get manager(){return this._manager}set manager(e){this._manager=e}set adapter(e){this._adapter=e;const t=null==e?void 0:e.defaultState;t&&(this.defaultState=Object.assign(Object.assign({},this.defaultState),t)),this._state=Object.assign(Object.assign({},this._state),this.defaultState)}get adapter(){return this._adapter}getState(){return this._state}updateState(e={}){this._adapter&&(this._state=Object.assign(Object.assign({},this._state),e),this._adapter.onStateUpdate(this._state,this.name),this._adapter.listeners.forEach((e=>{e&&e(Object.assign({},this._state),this.name)})))}publish(e,t){var i;const r=null===(i=this._manager)||void 0===i?void 0:i.subscribers;if(r){const i=r.get(e);i&&i.forEach((i=>{i(e,t)}))}}}t.AbstractService=i,t.default=i},8251:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{d(r.next(e))}catch(e){s(e)}}function a(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkService=t.NetworksChainId=void 0;const s=i(9757),o=n(i(9622)),a=n(i(8725)),d=i(2786);var c;(c=t.NetworksChainId||(t.NetworksChainId={})).rpc="",c.polygon="137",c.mumbai="80001";class l extends d.AbstractService{constructor(){super(...arguments),this.name="NetworkService",this.mutex=new s.Mutex}initialize(e){this.updateState({network:"loading"});const t={chainId:null==e?void 0:e.chainId,engineParams:{pollingInterval:12e3},nickname:null==e?void 0:e.nickname,rpcUrl:null==e?void 0:e.rpcTarget,ticker:null==e?void 0:e.ticker};this.provider=(0,a.default)(t),this.provider.on("error",this.onNetworkError.bind(this)),this.ethQuery=new o.default(this.provider),this.updateNetwork()}onNetworkError(){"loading"===this.getState().network&&this.updateNetwork()}updateNetwork(){return r(this,void 0,void 0,(function*(){if(!this.ethQuery||!this.ethQuery.sendAsync)return;const e=yield this.mutex.acquire();this.ethQuery.sendAsync({method:"net_version"},((t,i)=>{this.updateState({network:t?"loading":i}),e()}))}))}}t.NetworkService=l,t.default=l},2190:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WalletConnectPort=t.WebviewPort=void 0;const r=i(1239),n=i(2035),s=i(7542);class o extends r.EventEmitter{constructor(e,t){super(),this.postMessage=(e,t="*")=>{const i=this._isMainFrame?(0,s.JS_POST_MESSAGE_TO_PROVIDER)(e,t):(0,s.JS_IFRAME_POST_MESSAGE_TO_PROVIDER)(e,t);this._window.webViewRef&&this._window.webViewRef.current&&this._window&&this._window.injectJavaScript(i)},this._window=e,this._isMainFrame=t}}t.WebviewPort=o;class a extends r.EventEmitter{constructor(e,t){super(),this.postMessage=e=>{var t,i,r,s,o,a,d,c,l,u,h,v,p,g,S,_;try{if((null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.method)===n.NOTIFICATION_NAMES.chainChanged){const t=null===(r=null===(i=this.serviceManager)||void 0===i?void 0:i.getServiceByName("PreferencesService").getSelectedAddress())||void 0===r?void 0:r.toLowerCase();null===(o=null===(s=this._wcRequestActions)||void 0===s?void 0:s.updateSession)||void 0===o||o.call(s,{chainId:parseInt(e.data.params.chainId,16),accounts:[t]})}else if((null===(a=null==e?void 0:e.data)||void 0===a?void 0:a.method)===n.NOTIFICATION_NAMES.accountsChanged){const t=null===(c=null===(d=this.serviceManager)||void 0===d?void 0:d.getServiceByName("NetworkService").provider)||void 0===c?void 0:c.chainId;null===(u=null===(l=this._wcRequestActions)||void 0===l?void 0:l.updateSession)||void 0===u||u.call(l,{chainId:parseInt(t,10),accounts:e.data.params})}else(null===(h=null==e?void 0:e.data)||void 0===h?void 0:h.method)===n.NOTIFICATION_NAMES.unlockStateChanged||((null===(v=null==e?void 0:e.data)||void 0===v?void 0:v.error)?null===(g=null===(p=this._wcRequestActions)||void 0===p?void 0:p.rejectRequest)||void 0===g||g.call(p,{id:e.data.id,error:e.data.error}):null===(_=null===(S=this._wcRequestActions)||void 0===S?void 0:S.approveRequest)||void 0===_||_.call(S,{id:e.data.id,result:e.data.result}))}catch(e){console.warn(e)}},this._wcRequestActions=e,this.serviceManager=t}}t.WalletConnectPort=a},1706:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.setupMultiplex=t.jsonStringifyStream=t.jsonParseStream=t.ConnectionStream=void 0;const n=i(871),s=r(i(9203)),o=r(i(7304)),a=i(3248),d=r(i(700)),c=()=>{};class l extends a.Duplex{constructor(e,t){super({objectMode:!0}),this._read=c,this._port=e,this._url=t,this._port.addListener("message",this._onMessage.bind(this)),this._port.addListener("disconnect",this._onDisconnect.bind(this))}_onMessage(e){if(n.Buffer.isBuffer(e)){delete e._isBuffer;const t=new n.Buffer(e);this.push(t)}else this.push(e)}_onDisconnect(){this.destroy&&this.destroy()}_write(e,t,i){try{if(n.Buffer.isBuffer(e)){const t=e.toJSON();t._isBuffer=!0,this._port.postMessage(t,this._url)}else this._port.postMessage(e,this._url)}catch(e){return i(new Error("ConnectionStream - disconnected"))}return i()}}t.default=l,t.ConnectionStream=l,t.jsonParseStream=function(){return d.default.obj((function(e,t,i){this.push(JSON.parse(e)),i()}))},t.jsonStringifyStream=function(){return d.default.obj((function(e,t,i){this.push(JSON.stringify(e)),i()}))},t.setupMultiplex=function(e){const t=new s.default;return(0,o.default)(e,t,e,(e=>{e&&console.warn(e)})),t}},2035:function(e,t){var i=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};Object.defineProperty(t,"__esModule",{value:!0}),t.createLoggerMiddleware=t.createOriginMiddleware=t.NOTIFICATION_NAMES=void 0;const r=["user rejected","user denied","user cancelled"];t.NOTIFICATION_NAMES={accountsChanged:"digitalwallet_accountsChanged",unlockStateChanged:"digitalwallet_unlockStateChanged",chainChanged:"digitalwallet_chainChanged"},t.createOriginMiddleware=function(e){return function(t,i,r){t.origin=e.origin,t.params||(t.params=[]),r()}},t.createLoggerMiddleware=function(){return function(e,t,n){n((n=>{if(t.error){const{error:e}=t,n=i(t,["error"]);if(e&&!function(e,t){try{return!(!e||"string"!=typeof e||!r.some((t=>e.toLowerCase().includes(t.toLowerCase())))&&4001!==t)}catch(e){return!1}}(e.message,e.code)){let t=e;const i={message:"Error in RPC response",orginalError:e,res:n};e.message&&(t=new Error(e.message)),e.data&&(i.data=e.data,e.data.message&&(t=new Error(e.data.message)))}}e.isDigitalWalletInternal||n()}))}}},7021:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProviderBridge=void 0;const n=r(i(5761)),s=i(1239),o=i(8440),a=i(5198),d=r(i(7304)),c=i(4782),l=r(i(3883)),u=i(8251),h=i(2190),v=i(1706),p=i(2035);class g extends s.EventEmitter{constructor({webview:e,url:t,rpcMiddleware:i,isMainFrame:r,isWalletConnect:n,requestActions:s,getApprovedHosts:o,serviceManager:a}){var d,c,u,p,g,S,_,f,w,m;super(),this.sendStateUpdate=()=>{this.emit("update")},this.onMessage=e=>{this.port.emit("message",{name:e.name,data:e.data})},this.onDisconnect=()=>{var e,t;this.disconnected=!0,null===(e=this.serviceManager)||void 0===e||e.getServiceByName("NetworkService").adapter.removeStateListener(this.sendStateUpdate),null===(t=this.serviceManager)||void 0===t||t.getServiceByName("PreferencesService").adapter.removeStateListener(this.sendStateUpdate),this.port.emit("disconnect",{name:this.port.name,data:null})},this.url=t,this.hostname=new l.default(t).hostname,this.isMainFrame=r,this.isWalletConnect=n,this._webviewRef=e&&e.current,this.disconnected=!1,this.getApprovedHosts=o,this.rpcMiddleware=i,this.serviceManager=a;const N=null===(d=this.serviceManager)||void 0===d?void 0:d.getServiceByName("NetworkService").provider;this._providerProxy=null,this.setProvider({provider:N}),this.port=this.isWalletConnect?new h.WalletConnectPort(s,this.serviceManager):new h.WebviewPort(this._webviewRef,r),this.engine=null,this.chainIdSent=null===(u=null===(c=this.serviceManager)||void 0===c?void 0:c.getServiceByName("NetworkService").provider)||void 0===u?void 0:u.chainId,this.networkVersionSent=null===(p=this.serviceManager)||void 0===p?void 0:p.getServiceByName("NetworkService").NetworkType,this.addressSent=null===(S=null===(g=this.serviceManager)||void 0===g?void 0:g.getServiceByName("PreferencesService").getSelectedAddress())||void 0===S?void 0:S.toLowerCase();const M=new v.ConnectionStream(this.port,t),y=(0,v.setupMultiplex)(M);this.setupProviderConnection(y.createStream(n?"walletconnect-provider":"alphaUWallet-provider")),null===(_=this.serviceManager)||void 0===_||_.getServiceByName("NetworkService").adapter.addStateListener(this.sendStateUpdate),null===(f=this.serviceManager)||void 0===f||f.getServiceByName("PreferencesService").adapter.addStateListener(this.sendStateUpdate),null===(w=this.serviceManager)||void 0===w||w.getServiceByName("AccountService").onLock(this.onLock.bind(this)),null===(m=this.serviceManager)||void 0===m||m.getServiceByName("AccountService").onUnlock(this.onUnlock.bind(this)),this.on("update",this.onStateUpdate)}setProvider({provider:e}){this._providerProxy?this._providerProxy.setTarget(e):this._providerProxy=(0,c.createSwappableProxy)(e),this.provider=e}onUnlock(){this.disconnected||this.sendNotification({method:p.NOTIFICATION_NAMES.unlockStateChanged,params:!0})}onLock(){this.disconnected||this.sendNotification({method:p.NOTIFICATION_NAMES.unlockStateChanged,params:!1})}getProviderNetworkState({network:e}){var t,i,r;const n=null===(i=null===(t=this.serviceManager)||void 0===t?void 0:t.getServiceByName("NetworkService").provider)||void 0===i?void 0:i.type,s=null===(r=this.serviceManager)||void 0===r?void 0:r.getServiceByName("NetworkService").provider;let o;return n?o=u.NetworksChainId[n]:"rpc"===n&&(o=s.chainId),o&&!o.startsWith("0x")&&(o=`0x${parseInt(o,10).toString(16)}`),{networkVersion:e,chainId:o}}onStateUpdate(e){var t;const i=null===(t=this.serviceManager)||void 0===t?void 0:t.getServiceByName("NetworkService").provider;this.setProvider({provider:i}),e||(e=this.getState());const r=this.getProviderNetworkState(e);this.chainIdSent!==r.chainId&&this.networkVersionSent!==r.networkVersion&&"loading"!==r.networkVersion&&(this.chainIdSent=r.chainId,this.networkVersionSent=r.networkVersion,this.sendNotification({method:p.NOTIFICATION_NAMES.chainChanged,params:r})),this.isWalletConnect&&this.addressSent!==e.selectedAddress&&(this.addressSent=e.selectedAddress,this.sendNotification({method:p.NOTIFICATION_NAMES.accountsChanged,params:[e.selectedAddress]}))}isUnlocked(){var e;return null===(e=this.serviceManager)||void 0===e?void 0:e.getServiceByName("AccountService").isUnlocked()}getProviderState(){const e=this.getState();return Object.assign({isUnlocked:this.isUnlocked()},this.getProviderNetworkState(e))}setupProviderConnection(e){this.engine=this.setupProviderEngine();const t=(0,a.createEngineStream)({engine:this.engine});(0,d.default)(e,t,e,(e=>{this.engine._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),e&&console.log("Error with provider stream conn",e)}))}setupProviderEngine(){const e=this.hostname,t=new o.JsonRpcEngine,i=this._providerProxy;return t.push((0,p.createOriginMiddleware)({origin:e})),t.push((0,p.createLoggerMiddleware)()),t.push(this.rpcMiddleware({hostname:this.hostname,getProviderState:this.getProviderState.bind(this)})),t.push((0,n.default)(i)),t}sendNotification(e){this.engine&&this.engine.emit("notification",e)}getState(){var e,t,i,r,n,s;return{isInitialized:!!(null===(t=null===(e=this.serviceManager)||void 0===e?void 0:e.getServiceByName("AccountService"))||void 0===t?void 0:t.vault),isUnlocked:!0,network:null===(r=null===(i=this.serviceManager)||void 0===i?void 0:i.getServiceByName("NetworkService").provider)||void 0===r?void 0:r.type,selectedAddress:null===(s=null===(n=this.serviceManager)||void 0===n?void 0:n.getServiceByName("PreferencesService").getSelectedAddress())||void 0===s?void 0:s.toLowerCase()}}}t.ProviderBridge=g,t.default=g},7542:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JS_IFRAME_POST_MESSAGE_TO_PROVIDER=t.JS_POST_MESSAGE_TO_PROVIDER=void 0,t.JS_POST_MESSAGE_TO_PROVIDER=(e,t)=>`(function () {\n  try {\n    window.postMessage(${JSON.stringify(e)}, '${t}');\n  } catch (e) {\n    //Nothing to do\n  }\n})()`,t.JS_IFRAME_POST_MESSAGE_TO_PROVIDER=(e,t)=>"(function () {})()"},9757:e=>{e.exports=require("async-mutex")},871:e=>{e.exports=require("buffer")},5761:e=>{e.exports=require("eth-json-rpc-middleware/providerAsMiddleware")},9622:e=>{e.exports=require("eth-query")},1239:e=>{e.exports=require("events")},8440:e=>{e.exports=require("json-rpc-engine")},5198:e=>{e.exports=require("json-rpc-middleware-stream")},9203:e=>{e.exports=require("obj-multiplex")},7304:e=>{e.exports=require("pump")},3248:e=>{e.exports=require("readable-stream")},4782:e=>{e.exports=require("swappable-obj-proxy")},700:e=>{e.exports=require("through2")},3883:e=>{e.exports=require("url-parse")},8725:e=>{e.exports=require("web3-provider-engine/zero")}},t={};!function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(7021)})();